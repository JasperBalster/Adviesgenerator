<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Advies Generator TIGRA</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 700px; margin: 20px auto; }
  label { display: block; margin-top: 15px; font-weight: bold; }
  textarea, input, select { width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box; }
  button { margin-top: 20px; padding: 10px 15px; font-size: 16px; cursor: pointer; }
  #advies { margin-top: 25px; white-space: pre-wrap; background: #f0f0f0; padding: 15px; border-radius: 5px; min-height: 200px; }
</style>
</head>
<body>

<h1>Advies Generator TIGRA</h1>

<form id="adviesForm" onsubmit="event.preventDefault(); genereerAdvies();">

  <label for="naam">Naam getest persoon</label>
  <input type="text" id="naam" required />

  <label for="type">Type onderzoek</label>
  <select id="type" required>
    <option value="PMO">PMO</option>
    <option value="Healthcheck">Healthcheck</option>
    <option value="Sportkeuring">Sportkeuring</option>
  </select>

  <label for="bedrijf">Naam bedrijf</label>
  <input type="text" id="bedrijf" required />

  <label for="werkvermogen">Werkvermogen</label>
  <select id="werkvermogen" required>
    <option value="slecht">Slecht werkvermogen</option>
    <option value="matig">Matig werkvermogen</option>
    <option value="goed">Goed werkvermogen</option>
  </select>

  <label for="werk">Feedback werkgerelateerd</label>
  <textarea id="werk" rows="3"></textarea>

  <label for="leefstijl">Feedback leefstijl</label>
  <textarea id="leefstijl" rows="3"></textarea>

  <label for="biometrie">Feedback biometrie</label>
  <textarea id="biometrie" rows="3"></textarea>

  <label for="metingen">Gezondheidsmetingen (bloeddruk, HRV, cholesterol, bloedsuiker)</label>
  <textarea id="metingen" rows="3"></textarea>

  <label for="ogenoren">Ogen en oren</label>
  <textarea id="ogenoren" rows="2"></textarea>

  <label for="longfunctie">Longfunctie</label>
  <textarea id="longfunctie" rows="2"></textarea>

  <label for="fysiek">Fysieke metingen (conditie, kracht, etc.)</label>
  <textarea id="fysiek" rows="3"></textarea>

  <label for="extra">Extra opmerkingen adviseur</label>
  <textarea id="extra" rows="3"></textarea>

  <label for="contact">Contactgegevens adviseur</label>
  <textarea id="contact" rows="2" required></textarea>

  <button type="submit">Genereer Advies</button>

</form>

<div id="advies" tabindex="0" aria-label="Gegenereerd advies">
  <!-- Hier komt het advies te staan -->
</div>

<script>
async function genereerAdvies() {
  const naam = document.getElementById('naam').value.trim();
  const type = document.getElementById('type').value;
  const bedrijf = document.getElementById('bedrijf').value.trim();
  const werkvermogen = document.getElementById('werkvermogen').value;
  const werk = document.getElementById('werk').value.trim();
  const leefstijl = document.getElementById('leefstijl').value.trim();
  const biometrie = document.getElementById('biometrie').value.trim();
  const metingen = document.getElementById('metingen').value.trim();
  const ogenoren = document.getElementById('ogenoren').value.trim();
  const longfunctie = document.getElementById('longfunctie').value.trim();
  const fysiek = document.getElementById('fysiek').value.trim();
  const extra = document.getElementById('extra').value.trim();
  const contact = document.getElementById('contact').value.trim();

  // Eenvoudige uitleg per werkvermogen
  let uitlegWerkvermogen = "";
  if (werkvermogen === "goed") {
    uitlegWerkvermogen = "dat je je werk goed kunt uitvoeren zonder beperkingen.";
  } else if (werkvermogen === "matig") {
    uitlegWerkvermogen = "dat er enige beperkingen zijn die je kunnen hinderen bij het uitvoeren van je werk.";
  } else {
    uitlegWerkvermogen = "dat er aanzienlijke beperkingen zijn die je belemmeren bij het uitvoeren van je werk.";
  }

  const prompt = `
Beste ${naam},

Bedankt voor de deelname aan de ${type} via ${bedrijf}. Je scoort een ${werkvermogen} werkvermogen, wat betekent ${uitlegWerkvermogen}

Hieronder volgt een toelichting per onderwerp:

Werkgerelateerd:
${werk || "- geen opmerkingen -"}

Leefstijl:
${leefstijl || "- geen opmerkingen -"}

Biometrie:
${biometrie || "- geen opmerkingen -"}

Gezondheidsmetingen:
${metingen || "- geen opmerkingen -"}

Ogen en oren:
${ogenoren || "- geen opmerkingen -"}

Longfunctie:
${longfunctie || "- geen opmerkingen -"}

Fysieke metingen:
${fysiek || "- geen opmerkingen -"}

Extra opmerkingen:
${extra || "- geen opmerkingen -"}

Wij wijzen erop dat het ${type} een momentopname is. Bij klachten over uw gezondheid of inzetbaarheid dient u met uw huisarts of bedrijfsarts contact op te nemen. Mocht u over de uitslagen nog vragen hebben, dan kunt u met ondergetekende contact opnemen.

Met vriendelijke groet,  
${contact}
`;

  document.getElementById('advies').innerText = "Advies wordt geladen...";

  try {
    const response = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer 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"
      },
      body: JSON.stringify({
        model: "gpt-4o-mini",
        messages: [
          { role: "system", content: "Je bent een professionele adviseur die een vriendelijk en duidelijk advies schrijft aan een werknemer na een PMO/Healthcheck/Sportkeuring." },
          { role: "user", content: prompt }
        ],
        temperature: 0.7,
        max_tokens: 1000
      })
    });

    if (!response.ok) {
      throw new Error(`OpenAI API error: ${response.status} ${response.statusText}`);
    }

    const data = await response.json();
    const adviesTekst = data.choices[0].message.content;

    document.getElementById('advies').innerText = adviesTekst;

  } catch (error) {
    document.getElementById('advies').innerText = `Fout bij het ophalen van advies: ${error.message}`;
    console.error(error);
  }
}
</script>

</body>
</html>
